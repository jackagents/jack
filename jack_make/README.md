# JACK Make

## Requirements

| Dependency | Vendored | License | Notes                                                                                  |
| ---------- | -------- | ------- | -------------------------------------------------------------------------------------- |
| rust       | No       |         | For building jack-make, see: https://rustup.rs for installation                        |
| wasm-pack  | No       |         | **(Optional)** For WASM model validator, requires `rust` and "cargo install wasm-pack" |

### jack-make

`jack-make` generates C++ code to interoperate with JACK from a JACK model
file. The JACK model file contains the relationships between the BDI model,
teams and agents in the multi-agent system. The code generated allows using
these teams and agents and their BDI components inside JACK with type safety.

For debug and release respectively run the following commands

```bash
cargo build [--release]
```

The binaries are available in the following location,
`target/[debug|release]/jack-make.exe`.

To create a `.deb` package

1. Install the pre-requisite package via `cargo install cargo-deb`
2. Run `cargo deb` in the `tools/jack-validator` directory

### jack-validator WASM

The validator component of `jack-make` can be exported as WASM library by
running the folowing commands in the root directory:

```bash
wasm-pack build --target web
```

A `target/wasm32-unknown-unknown/[debug|release]` folder will be created in the
root of the directory, this will contain a NPM package that can be used in
Javascript.

`jack-edit` currently uses `yalc` to manage local node modules that can be
retrieved by `npm` when building the editor. The WASM exported by Rust can be
used by installing the WASM blob to `yalc`'s local repository. This can be done
by the following commands:

```bash
npm i yalc -g
cd pkg
yalc publish
```

For more information see Mozilla's reference tutorial,
[Rust to wasm](https://developer.mozilla.org/en-US/docs/WebAssembly/Rust_to_wasm)

## Architecture

This library exports 2 binaries, `jack-make` and the model validation library
in WASM. The main entry points are `src/bin/jack-make.rs` and
`src/bin/jack-validator.rs` respectively which thunk into `src/lib.rs`.

Models are passed to the application or APIs and loaded recursively in a DFS
approach (meaning the deepest, most nested module is loaded first) to ensure
that JACK symbol references in the top-most projects are resolvable.

All loaded models are migrated up incrementally version by version to the
latest via `src/migration.rs`. All model files are versioned and preserved in
`src/model_v*.rs` which permit prior releases to migrate to the latest version.

Upon completion, Rust reflects the JSON into the equivalent struct via `serde`.
Additional runtime data that is not in the JSON model is populated into
the Rust model such as `Identifier::bumpy_case` for convenience in code
generation.

The model is then validated and code is then generated by piping the model into
template files via `src/templates.rs` which pulls in the templating files
located in `templates`.
